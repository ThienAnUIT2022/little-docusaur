<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-endpoint-security/ClamAV-report" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">ClamAV Reporting | little Whale&#x27;s Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://ThienAnUIT2022.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://ThienAnUIT2022.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://ThienAnUIT2022.github.io/docs/endpoint-security/ClamAV-report"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ClamAV Reporting | little Whale&#x27;s Site"><meta data-rh="true" name="description" content="Tiếp nối bài thử nghiệm khả năng phát hiện malware của ClamAV lần trước, bài này trình bày chi tiết về cách cấu hình và sử dụng ClamAV để quét thời gian thực trên Linux và quét tự động trên Windows."><meta data-rh="true" property="og:description" content="Tiếp nối bài thử nghiệm khả năng phát hiện malware của ClamAV lần trước, bài này trình bày chi tiết về cách cấu hình và sử dụng ClamAV để quét thời gian thực trên Linux và quét tự động trên Windows."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://ThienAnUIT2022.github.io/docs/endpoint-security/ClamAV-report"><link data-rh="true" rel="alternate" href="https://ThienAnUIT2022.github.io/docs/endpoint-security/ClamAV-report" hreflang="en"><link data-rh="true" rel="alternate" href="https://ThienAnUIT2022.github.io/docs/endpoint-security/ClamAV-report" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="little Whale&#39;s Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="little Whale&#39;s Site Atom Feed">





<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.aff420c1.css">
<script src="/assets/js/runtime~main.c9a5248b.js" defer="defer"></script>
<script src="/assets/js/main.dd3eed00.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">My Site</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/portfolio">Study with little Whale</a><a class="navbar__item navbar__link" href="/blog">little Whale&#x27;s autobiography</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/portfolio">I&#x27;m little Whale :3</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/gg-cybersec-cert">GG CyberSec Cert</a><button aria-label="Expand sidebar category &#x27;GG CyberSec Cert&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/letsdefend-soc-analyst">LetsDefend SOC Analyst</a><button aria-label="Expand sidebar category &#x27;LetsDefend SOC Analyst&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/cyberdefenders-training">CyberDefenders Training</a><button aria-label="Expand sidebar category &#x27;CyberDefenders Training&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/nt114---endpoint-security">NT114 - Endpoint Security</a><button aria-label="Collapse sidebar category &#x27;NT114 - Endpoint Security&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/endpoint-security/ClamAV-testing">ClamAV Testing on Windows and Kali</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/endpoint-security/ClamAV-report">ClamAV Reporting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/endpoint-security/ClamAV">ClamAV - Open-source Anti-virus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/endpoint-security/Elastic-stack">Elastic Stack Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/endpoint-security/OSSEC">OSSEC - Host-based IDS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/endpoint-security/malware-attack">Malware attacks - Tổng hợp cơ chế tấn công của mã độc</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/nt207---risk-management--infosec">NT207 - Risk Management &amp; InfoSec</a><button aria-label="Expand sidebar category &#x27;NT207 - Risk Management &amp; InfoSec&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/nt114---endpoint-security"><span itemprop="name">NT114 - Endpoint Security</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">ClamAV Reporting</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>ClamAV Reporting</h1></header><p>Tiếp nối bài thử nghiệm khả năng phát hiện malware của ClamAV lần trước, bài này trình bày chi tiết về cách cấu hình và sử dụng ClamAV để quét <strong>thời gian thực</strong> trên Linux và quét <strong>tự động</strong> trên Windows.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-cấu-hình-và-sử-dụng-trên-kali-linux">1. Cấu hình và sử dụng trên Kali Linux<a href="#1-cấu-hình-và-sử-dụng-trên-kali-linux" class="hash-link" aria-label="Direct link to 1. Cấu hình và sử dụng trên Kali Linux" title="Direct link to 1. Cấu hình và sử dụng trên Kali Linux">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-quản-lý-services-và-cấu-hình">1.1. Quản lý services và cấu hình<a href="#11-quản-lý-services-và-cấu-hình" class="hash-link" aria-label="Direct link to 1.1. Quản lý services và cấu hình" title="Direct link to 1.1. Quản lý services và cấu hình">​</a></h3>
<p>Sau khi cài đặt ClamAV, sẽ có ba dịch vụ chính phục vụ cho cả cập nhật database, quét theo yêu cầu và quét thời gian thực:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl status clamav-freshclam.service    # cập nhật signature DB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl status clamav-daemon.service       # dịch vụ quét nền</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl status clamav-onacc.service        # quét thời gian thực</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Trước khi chỉnh sửa, hãy backup hai file cấu hình quan trọng:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo cp /etc/clamav/clamd.conf ~/clamav-config-backup/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo cp /etc/systemd/system/clamav-onacc.service ~/clamav-config-backup/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><strong><code>/etc/clamav/clamd.conf</code></strong>: Cấu hình ClamD (daemon quét nền).</li>
<li><strong><code>/etc/systemd/system/clamav-onacc.service</code></strong>: Cấu hình dịch vụ On-Access Scanning.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-quét-theo-yêu-cầu-on-demand-scan">1.2. Quét theo yêu cầu (On-Demand Scan)<a href="#12-quét-theo-yêu-cầu-on-demand-scan" class="hash-link" aria-label="Direct link to 1.2. Quét theo yêu cầu (On-Demand Scan)" title="Direct link to 1.2. Quét theo yêu cầu (On-Demand Scan)">​</a></h3>
<p>Lệnh quét cơ bản:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">clamscan [options] [file|directory|-]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Ví dụ minh họa các nhóm tùy chọn:<br>
<img decoding="async" loading="lazy" alt="scan_opt1" src="/assets/images/clamav-opt1-f23c0e3f7baeab27a82354c8966e292e.png" width="960" height="344" class="img_ev3q"><br>
<img decoding="async" loading="lazy" alt="scan_opt2" src="/assets/images/clamav-opt2-07e74e188665f75d1d03b956c71d30e9.png" width="969" height="270" class="img_ev3q"><br>
<img decoding="async" loading="lazy" alt="scan_opt3" src="/assets/images/clamav-opt3-0d7e49565603d26f25c6969b08f801c9.png" width="960" height="222" class="img_ev3q"></p>
<p>Và ví dụ thực thi:</p>
<p><img decoding="async" loading="lazy" alt="clamscan1" src="/assets/images/clamscan1-fb97d023bf61c008bb438e91f6a54982.png" width="960" height="338" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-quét-thời-gian-thực-on-access-scanning">1.3. Quét thời gian thực (On-Access Scanning)<a href="#13-quét-thời-gian-thực-on-access-scanning" class="hash-link" aria-label="Direct link to 1.3. Quét thời gian thực (On-Access Scanning)" title="Direct link to 1.3. Quét thời gian thực (On-Access Scanning)">​</a></h3>
<blockquote>
<p><strong>Lưu ý</strong>: Tính năng chỉ hỗ trợ Linux với kernel có <strong>fanotify</strong> enabled.</p>
</blockquote>
<ol>
<li>
<p>Kiểm tra fanotify:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">grep FANOTIFY /boot/config-$(uname -r)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>CONFIG_FANOTIFY=y</code></li>
<li><code>CONFIG_FANOTIFY_ACCESS_PERMISSIONS=y</code></li>
</ul>
</li>
<li>
<p>Cấu hình <code>/etc/clamav/clamd.conf</code>:<br>
<img decoding="async" loading="lazy" alt="clamd.conf" src="/assets/images/clamdconf-e68c5084f954562c6a855c719911bb0e.png" width="1176" height="774" class="img_ev3q"></p>
</li>
<li>
<p>Script thông báo thay thế (<code>/etc/clamav/detected.sh</code>):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> #!/bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> export LOG=&quot;/var/log/clamav/scan.log&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> export TARGET=&quot;/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> export SUMMARY_FILE=`mktemp`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> export SCAN_STATUS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> export INFECTED_SUMMARY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> export XUSERS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> echo &quot;------------ SCAN START ------------&quot; &gt;&gt; &quot;$LOG&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> echo &quot;Running scan on `date`&quot; &gt;&gt; &quot;$LOG&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> sudo clamdscan --log &quot;$LOG&quot; --infected --multiscan --fdpass &quot;$TARGET&quot; &gt; &quot;$SUMMARY_FILE&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> SCAN_STATUS=&quot;$?&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> INFECTED_SUMMARY=`cat $SUMMARY_FILE | grep Infected`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> rm &quot;$SUMMARY_FILE&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> if [[ &quot;$SCAN_STATUS&quot; -ne &quot;0&quot; ]] ; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   # Send the alert to systemd logger if exist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   if [[ -n $(command -v systemd-cat) ]] ; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     echo &quot;Virus signature found - $INFECTED_SUMMARY&quot; | /usr/bin/systemd-cat -t clamav -p emerg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   # Send an alert to all graphical users.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   XUSERS=($(who|awk &#x27;{print $1$NF}&#x27;|sort -u))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   for XUSER in $XUSERS; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     NAME=(${XUSER/(/ })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     DISPLAY=${NAME[1]/)/}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     DBUS_ADDRESS=unix:path=/run/user/$(id -u ${NAME[0]})/bus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     echo &quot;run $NAME - $DISPLAY - $DBUS_ADDRESS -&quot; &gt;&gt; /tmp/testlog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     /usr/bin/sudo -u ${NAME[0]} DISPLAY=${DISPLAY} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       DBUS_SESSION_BUS_ADDRESS=${DBUS_ADDRESS} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       PATH=${PATH} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       /usr/bin/notify-send -i security-low &quot;Virus signature(s) found&quot; &quot;$INFECTED_SUMMARY&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Cập nhật quyền thực thi cho script.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo chmod +x /etc/clamav/detected.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Cấu hình service On-Access:<br>
<img decoding="async" loading="lazy" alt="clam-onacc.service" src="/assets/images/clam-onacc-11753ec5b30a35b452ee29f6873f2d8e.png" width="961" height="408" class="img_ev3q"></p>
</li>
<li>
<p>Khởi động và bật auto-start:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl enable clamav-onacc.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl start clamav-onacc.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl status clamav-onacc.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p>Theo dõi log realtime:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tail -f /var/log/clamav/clamav.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># hoặc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">grep &quot;FOUND&quot; /var/log/clamav/clamav.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="linux realtime scan" src="/assets/images/linux_real_scan-2ff64753f0c59c9468f5de7818ce2815.png" width="960" height="711" class="img_ev3q"></p>
</li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-cấu-hình-và-sử-dụng-trên-windows">2. Cấu hình và sử dụng trên Windows<a href="#2-cấu-hình-và-sử-dụng-trên-windows" class="hash-link" aria-label="Direct link to 2. Cấu hình và sử dụng trên Windows" title="Direct link to 2. Cấu hình và sử dụng trên Windows">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-quét-tự-động-định-kỳ-scheduled-scan">2.1. Quét tự động định kỳ (Scheduled Scan)<a href="#21-quét-tự-động-định-kỳ-scheduled-scan" class="hash-link" aria-label="Direct link to 2.1. Quét tự động định kỳ (Scheduled Scan)" title="Direct link to 2.1. Quét tự động định kỳ (Scheduled Scan)">​</a></h3>
<p>Tạo file batch <code>clamscan_daily.bat</code>:</p>
<div class="language-bat codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bat codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@echo off</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;C:\Program Files\ClamAV\clamscan.exe&quot; --recursive --infected --log=&quot;C:\clamav_logs\scan_%date%.log&quot; C:\Users</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Task Scheduler</strong>:</p>
<ol>
<li>
<p><strong>Create Basic Task</strong> “Daily ClamAV Scan”</p>
</li>
<li>
<p>Triggers → <strong>Daily</strong> → chọn thời gian, lặp lại theo khoảng.</p>
</li>
<li>
<p>Actions → <strong>Start a program</strong> → trỏ tới <code>clamscan_daily.bat</code>.</p>
</li>
<li>
<p>Chạy thử:</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">schtasks /run /tn &quot;Daily ClamAV Scan&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="windows real scan" src="/assets/images/win_real_scan-982e1b70eae2c237f2f884fcfdb057a7.png" width="778" height="405" class="img_ev3q"><br>
<img decoding="async" loading="lazy" alt="windows real scan log" src="/assets/images/win_real_scan_log-2eb0f83443006c74b4c093a0a7f1b621.png" width="1028" height="499" class="img_ev3q"></p>
</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-quét-usb-tự-động-khi-cắm">2.2. Quét USB tự động khi cắm<a href="#22-quét-usb-tự-động-khi-cắm" class="hash-link" aria-label="Direct link to 2.2. Quét USB tự động khi cắm" title="Direct link to 2.2. Quét USB tự động khi cắm">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="221-tạo-powershell-script--batch-wrapper">2.2.1. Tạo PowerShell script &amp; batch wrapper<a href="#221-tạo-powershell-script--batch-wrapper" class="hash-link" aria-label="Direct link to 2.2.1. Tạo PowerShell script &amp; batch wrapper" title="Direct link to 2.2.1. Tạo PowerShell script &amp; batch wrapper">​</a></h4>
<p><strong>usb_scan.ps1</strong> (English, no Unicode):</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Load Windows Forms library</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Add-Type -AssemblyName System.Windows.Forms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Initialize log file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$logFile = &quot;C:\clamav_logs\usb_scan.log&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$timestamp = Get-Date -Format &quot;yyyy-MM-dd HH:mm:ss&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;====== Script started at $timestamp ======&quot; | Out-File -Append $logFile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Find USB drives</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$usbDrives = Get-WmiObject Win32_LogicalDisk | Where-Object { $_.DriveType -eq 2 }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ($usbDrives) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    foreach ($drive in $usbDrives) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Write-Host &quot;Detected USB Drive: $($drive.DeviceID)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&gt;&gt; Scanning drive $($drive.DeviceID)&quot; | Out-File -Append $logFile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Update virus database</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &amp; &quot;C:\Program Files\ClamAV\freshclam.exe&quot; | Out-File -Append $logFile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Scan the USB drive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $scanResult = Start-Process -FilePath &quot;C:\Program Files\ClamAV\clamscan.exe&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                     -ArgumentList &quot;--recursive --alert-broken --alert-encrypted --alert-macros --move=C:\Users\$env:USERNAME\Downloads\isolate --log=$logFile $($drive.DeviceID)\&quot; `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                     -Wait `</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                     -PassThru</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Check the exit code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if ($scanResult.ExitCode -eq 1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [System.Windows.Forms.MessageBox]::Show(&quot;Virus detected on USB drive $($drive.DeviceID)! The drive will be unmounted!&quot;, &quot;ClamAV Alert&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [System.Windows.Forms.MessageBoxButtons]::OK, [System.Windows.Forms.MessageBoxIcon]::Warning)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # Only if virus detected, then unmount the USB drive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $volInfo = Get-CimInstance -ClassName Win32_Volume | Where-Object { $_.DriveLetter -eq $drive.DeviceID }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if ($volInfo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                $guidPath = $volInfo.DeviceID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Write-Host &quot;Unmounting USB: $guidPath&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;Unmounting USB: $guidPath&quot; | Out-File -Append $logFile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                mountvol.exe $($drive.DeviceID) /d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Write-Host &quot;Failed to find volume GUID to unmount.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;Failed to find volume GUID to unmount.&quot; | Out-File -Append $logFile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } elseif ($scanResult.ExitCode -eq 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            # USB clean, show info message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [System.Windows.Forms.MessageBox]::Show(&quot;USB drive $($drive.DeviceID) is clean. You can use it safely.&quot;, &quot;ClamAV Scan Result&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [System.Windows.Forms.MessageBoxButtons]::OK, [System.Windows.Forms.MessageBoxIcon]::Information)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Write-Host &quot;No USB drive detected.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;No USB drive detected.&quot; | Out-File -Append $logFile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Script end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$timestamp = Get-Date -Format &quot;yyyy-MM-dd HH:mm:ss&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;====== Script ended at $timestamp ======&quot; | Out-File -Append $logFile</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>usb_scan.bat</strong>:</p>
<div class="language-bat codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bat codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@echo off</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">powershell.exe -ExecutionPolicy Bypass -NoProfile -File &quot;C:\Users\%USERNAME%\Desktop\usb_scan.ps1&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="222-cấu-hình-task-scheduler">2.2.2. Cấu hình Task Scheduler<a href="#222-cấu-hình-task-scheduler" class="hash-link" aria-label="Direct link to 2.2.2. Cấu hình Task Scheduler" title="Direct link to 2.2.2. Cấu hình Task Scheduler">​</a></h4>
<ol>
<li><strong>Create Task</strong> → Name: “ClamAV USB Scan”</li>
<li><strong>General</strong>: Run with highest privileges; Configure: Windows 10.</li>
<li><strong>Triggers</strong>: On an event →<!-- -->
<ul>
<li>Log: <code>Microsoft-Windows-DeviceSetupManager/Admin</code></li>
<li>Source: <code>Microsoft-Windows-DeviceSetupManager</code></li>
<li>Event ID: <code>131</code></li>
</ul>
</li>
<li><strong>Actions</strong>: Start a program → <code>usb_scan_safe.bat</code>.</li>
<li><strong>Conditions</strong>: (tuỳ chọn) AC power only.</li>
<li>Kiểm tra kết quả:<!-- -->
<ul>
<li>USB clean: <img decoding="async" loading="lazy" alt="usb scan clean" src="/assets/images/win_usb_scan_clean-1d16534fe312938184374602dbe07be3.png" width="1200" height="582" class="img_ev3q"></li>
<li>USB nhiễm: <img decoding="async" loading="lazy" alt="usb scan mal" src="/assets/images/win_usb_scan_mal-e4f4195e1ad1398f2821da361b8aa40d.png" width="960" height="470" class="img_ev3q"></li>
<li>Log: <img decoding="async" loading="lazy" alt="usb scan log" src="/assets/images/win_usb_scan_log-25540048ed69d9cd7b587a7cf1216b48.png" width="865" height="625" class="img_ev3q"></li>
</ul>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="223-một-số-lỗi-đã-gặp">2.2.3. Một số lỗi đã gặp<a href="#223-một-số-lỗi-đã-gặp" class="hash-link" aria-label="Direct link to 2.2.3. Một số lỗi đã gặp" title="Direct link to 2.2.3. Một số lỗi đã gặp">​</a></h4>
<table><thead><tr><th>Lỗi</th><th>Nguyên nhân</th><th>Ảnh hưởng</th></tr></thead><tbody><tr><td>win32_openat: Failed...</td><td>File path quá dài / file locked / permission deny</td><td>ClamAV không lấy metadata file</td></tr><tr><td>ERROR: Can&#x27;t unlink &#x27;...&#x27; after copy</td><td><code>--move</code> cố xóa file gốc nhưng thất bại do lock / path quá dài</td><td>File malware vẫn tồn trên USB</td></tr></tbody></table>
<p><strong>Khắc phục</strong>:</p>
<ul>
<li>Không dùng <code>--move</code> hoặc <code>--remove</code>.</li>
<li>Bật LongPathsEnabled trong registry.</li>
<li>(Tùy chọn) Thêm bước xóa file bằng PowerShell nếu di chuyển không thành công.</li>
</ul>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="kết-luận">Kết luận<a href="#kết-luận" class="hash-link" aria-label="Direct link to Kết luận" title="Direct link to Kết luận">​</a></h2>
<p>Trong bài này, tôi đã:</p>
<ul>
<li><strong>Thiết lập</strong> ClamAV quét thời gian thực trên Linux với <code>clamd</code> + <code>clamonacc</code>.</li>
<li><strong>Tùy chỉnh</strong> thông báo bằng script <code>detected.sh</code>.</li>
<li><strong>Lập lịch</strong> quét định kỳ trên Windows bằng Task Scheduler.</li>
<li><strong>Tự động quét USB</strong> khi cắm vào, phát hiện malware, và cách ly ổ đĩa.</li>
</ul>
<p><strong>Đã hoàn thành</strong>:</p>
<ul>
<li>Cấu hình services và file config trên Kali.</li>
<li>Script PowerShell &amp; Task để quét USB an toàn trên Windows.</li>
<li>Xử lý báo cáo phát hiện, cách ly file và unmount USB.</li>
</ul>
<p><strong>Vẫn còn hạn chế</strong>:</p>
<ul>
<li>Một số file malware không thể xóa do path quá dài hoặc file locked.</li>
<li>Cần bổ sung bước xóa thủ công qua PowerShell.</li>
<li>Quét realtime trên Windows vẫn phụ thuộc script chứ không native.</li>
</ul>
<p><strong>Nhận xét</strong>:<br>
<!-- -->Trên Linux, ClamAV cung cấp quét realtime mạnh mẽ nhờ fanotify. Trên Windows, phải dùng Task Scheduler kết hợp PowerShell để đạt được tự động hóa, vẫn còn một số giới hạn về xóa file locked và path dài. Tuy nhiên, với các thủ thuật bổ sung (LongPaths, script phụ trợ), ClamAV vẫn là một giải pháp hiệu quả, chi phí thấp cho nhu cầu quét tự động và giám sát USB.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/endpoint-security/ClamAV-report.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/endpoint-security/ClamAV-testing"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ClamAV Testing on Windows and Kali</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/endpoint-security/ClamAV"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ClamAV - Open-source Anti-virus</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-cấu-hình-và-sử-dụng-trên-kali-linux" class="table-of-contents__link toc-highlight">1. Cấu hình và sử dụng trên Kali Linux</a><ul><li><a href="#11-quản-lý-services-và-cấu-hình" class="table-of-contents__link toc-highlight">1.1. Quản lý services và cấu hình</a></li><li><a href="#12-quét-theo-yêu-cầu-on-demand-scan" class="table-of-contents__link toc-highlight">1.2. Quét theo yêu cầu (On-Demand Scan)</a></li><li><a href="#13-quét-thời-gian-thực-on-access-scanning" class="table-of-contents__link toc-highlight">1.3. Quét thời gian thực (On-Access Scanning)</a></li></ul></li><li><a href="#2-cấu-hình-và-sử-dụng-trên-windows" class="table-of-contents__link toc-highlight">2. Cấu hình và sử dụng trên Windows</a><ul><li><a href="#21-quét-tự-động-định-kỳ-scheduled-scan" class="table-of-contents__link toc-highlight">2.1. Quét tự động định kỳ (Scheduled Scan)</a></li><li><a href="#22-quét-usb-tự-động-khi-cắm" class="table-of-contents__link toc-highlight">2.2. Quét USB tự động khi cắm</a></li></ul></li><li><a href="#kết-luận" class="table-of-contents__link toc-highlight">Kết luận</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">little Whale&#x27;s autobiography</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>